<template>

<div id="view" class="pt52">
    <!-- ìƒë‹¨ -->
    <div class="content">
        <div class="inner inner914 m_center w100">
            <div class="cont_top flex alstart rel">

                <!-- ì¢Œì¸¡ ì œëª© & ì´ë¯¸ì§€ -->
                <div class="title flex column rel">
                    <div class="tit fs35 fwt600">
                        ì‹ë£Œí’ˆ í”Œë«í¼<br>
                        ì¸í„°ë·°ì´ë¥¼<br class="pc_view">
                        ëª¨ì§‘í•©ë‹ˆë‹¤.
                    </div>
                    <div class="img br5">
                        <img src="@/assets/img/sample_img_3.png" alt="">
                    </div>
                </div>

                <!-- ìš°ì¸¡ ìƒì„¸ì •ë³´ -->
                <div class="info">

                    <!-- ì •ë³´ -->
                    <ul class="info_list">
                        <li class="list flex alc fs18">
                            <span class="list_tit">ëª¨ì§‘ê¸°ê°„</span>
                            <em class="list_value">23.05.24 ~ 23.06.18</em>
                        </li>
                        <li class="list flex alc fs18">
                            <span class="list_tit">ëª¨ì§‘ì¸ì›</span>
                            <em class="list_value">3ëª…</em>
                        </li>
                        <li class="list flex alc fs18">
                            <span class="list_tit">ì¸í„°ë·° ì¼ì</span>
                            <em class="list_value">23.05.03(ì›”)</em>
                        </li>
                        <li class="list flex alc fs18">
                            <span class="list_tit">ì¸í„°ë·° ì‹œê°„</span>
                            <em class="list_value">1ì‹œê°„</em>
                        </li>
                        <li class="list flex alc fs18">
                            <span class="list_tit">ì¸í„°ë·° ë°©ì‹</span>
                            <em class="list_value">ëŒ€ë©´</em>
                        </li>
                        <li class="list flex alc fs18">
                            <span class="list_tit">ì¸í„°ë·° ì‚¬ë¡€ë¹„</span>
                            <em class="list_value">30,000ì›</em>
                        </li>
                    </ul>
                    <!-- ê³µìœ í•˜ê¸° -->
                    <div class="share_btn fs15">
                        <span class="pointer" @click="getClip()"><em class="fs20">ğŸ“¤</em>ì§€ì¸ì—ê²Œ ì•Œë ¤ì£¼ê¸°</span>
                    </div>
                    <!-- ì§€ì›&ë¬¸ì˜ ë²„íŠ¼ -->
                    <div class="button_area flex alc">
                        <button class="apply_btn btn_black" @click="getModal('viewApply');">ì§€ì›í•˜ê¸°</button>
                        <button class="inquiry_btn btn_border" @click="getModal('viewApply');">ë¬¸ì˜í•˜ê¸°</button>
                    </div>
                </div>
                <!-- ìš°ì¸¡ ìƒì„¸ì •ë³´ -->
                <div class="hit fs15 fc15 abs pc_view">
                    ì¡°íšŒìˆ˜ &nbsp; 250
                </div>

            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ -->
    <div class="content bc2">
        <div class="inner inner914 m_center w100">
            <div class="cont_bot">

                <!-- ìƒì„¸ë‚´ìš© -->
                <div class="detail_area">
                    <div class="title fs20 fwt500">ìƒì„¸ë‚´ìš©</div>
                    <div class="detail_box fs17 bc0 br5 fc10" id="managerInfo">
                        ì•ˆë…•í•˜ì„¸ìš”!!í˜„ì¬ ì œê°€ ìŠ¤í¬ì¸ ì¸ë“¤ì„ ìœ„í•œ ì„œë¹„ìŠ¤ë¥¼ ì¤€ë¹„ì¤‘ì— ìˆëŠ”ë°ìš”!<br>
                        ê´€ë ¨í•˜ì—¬ ê°„ë‹¨í•œ ì‚¬ìš©ì ì¸í„°ë·° ì§„í–‰í•˜ê³  ì‹¶ì–´, ì˜¨/ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ì°¸ì—¬ ê°€ëŠ¥í•˜ì‹¤ ìŠ¤í¬ì¸ ì¸ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤!<br>
                        3040 ë‚¨ì„±ë¶„ë“¤ ì¤‘ ê³¨í”„,í…Œë‹ˆìŠ¤,ë°°ë“œë¯¼í„´,íƒêµ¬ ë“± ë¼ì¼“ì´ë‚˜ ì¥ë¹„ í™œìš©í•˜ëŠ” ìŠ¤í¬ì¸ ë¡œ í•œë‹¬ì— ìµœì†Œ 2ê°œ ì¢…ëª© ì´ìƒ ìŠ¤í¬ì¸  í™œë™ì´ ì°¸ì—¬í•˜ì‹œëŠ” ë¶„ì´ë©´ ê°€ì¥ ì¢‹ê³  ê·¸ë ‡ì§€ ì•Šë”ë¼ë„ ìŠ¤í¬ì¸  í™œë™ì— ì—´ì •ì ì´ì‹ ë¶„ (ìµœì†Œ ì£¼ 1íšŒ ì´ìƒ) ì´ë©´ ëˆ„êµ¬ë“  ê´œì°®ìŠµë‹ˆë‹¤!<br>
                        (íŠ¹íˆ ê³¨í”„,í…Œë‹ˆìŠ¤,ë°°ë“œë¯¼í„´,ìŠ¤ì¿¼ì‹œ,íƒêµ¬ ë“±ì„ í•˜ì‹œëŠ” ë¶„ì´ë©´ ë”ìš± ì¢‹ìŠµë‹ˆë‹¤!!)ë¹„ìš©ì„ ë“œë¦¬ì§€ëŠ” ëª»í•˜ì§€ë§Œ ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ëµ™ê²Œë˜ë©´ ë§›ìˆëŠ” ì»¤í”¼í•œì”+ìŠ¤ë²…ì¿ í° / ì˜¨ë¼ì¸ ì¸í„°ë·°ì‹œ ìŠ¤ë²…ì¿ í° ë³„ë„ ì œê³µ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
                        ê´€ì‹¬ ìˆìœ¼ì‹  ë¶„ì€ ëŒ“ê¸€ ë‚¨ê²¨ ì£¼ì‹œë©´ ì±„íŒ… ë“œë¦´ê²Œìš”:)
                    </div>
                </div>

                <!-- ë‹´ë‹¹ì ì •ë³´ -->
                <div class="manager_area">
                    <div class="title fs20 fwt500">ë‹´ë‹¹ì ì •ë³´</div>
                    <ul class="manager_list fs16 fc9">
                        <li class="list flex alc">
                            <span class="mng_tit">ë‹´ë‹¹ìëª…</span>
                            <em class="mng_value">í™ê¸¸ë™</em>
                        </li>
                        <li class="list flex alc">
                            <span class="mng_tit">ì „í™”ë²ˆí˜¸</span>
                            <em class="mng_value">010-2023-2829</em>
                        </li>
                        <li class="list flex alc">
                            <span class="mng_tit">ì´ë©”ì¼</span>
                            <em class="mng_value">
                                Customerinterview<br class="mo_view">@naver.com
                            </em>
                        </li>
                    </ul>
                </div>

                <!-- Q&A -->
                <div class="qa_area">

                    <div class="title fs20 fwt500">Q&A</div>

                    <textarea class="qa_box br5 bc0 fs17 fc10 w100" v-model="state.question.content" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>

                    <div class="qa_btn">
                        <button class="btn_black fwt500"  @click="setProductquestion">ë¬¸ì˜í•˜ê¸°</button>
                    </div>
                    <!-- v-for -->
                    <div class="qa_box2 br5 bc0 fc10" v-for="(item,index) in state.questionList" :key="index">
                        <div class="question" :class="'question'+item.id" >
                            <div class="inner rel">
                                <div class="name fs17 fwt500">{{item.regUserNm}}</div>
                                <div class="date fs15">{{item.regDate}}</div>
                                <div class="cont fs15" >
                                {{ item.content }}
                                </div>
                                <textarea name="name" rows="8" cols="80" class="w100" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" style="display: none;"></textarea>
                                <div class="btn_area flex alc abs top0 right0">
                                    <button class="btn_border ok_btn"  @click ="modifyReply('question',item)" style="display: none;">í™•ì¸</button>
                                    <button class="btn_border ok_cancel" @click="cancelReply('question',item.id)" style="display: none;">ì·¨ì†Œ</button>
                                    <button class="btn_border update_btn" @click="editReply('question',item.id)">ìˆ˜ì •</button>
                                    <button class="btn_border delete_btn" @click="delQuestion('question',item.id)">ì‚­ì œ</button>
                                </div>
                            </div>
                        </div>

                        <div class="answer" v-if="item.answer==null">
                            <div class="inner rel">
                                <div class="tit fs17 fwt500">ë¬¸ì˜í•˜ì‹  ì‚¬í•­ì— ë‹µë³€ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.</div>
                                <textarea name="name" rows="8" cols="80" class="w100" placeholder="ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" v-model="state.answer.content"></textarea>
                                <button class="btn_black fwt500 ans_btn block m_center" @click="setProductAnswer">ë‹µë³€ë“±ë¡</button>
                            </div>
                        </div>

                        <div class="answer" :class="'answer'+item.answer.id" v-if="item.answer">
                            <div class="inner rel">
                                <div class="name fs17 fwt500 flex alc">
                                    {{item.answer.regUserNm}}
                                    <span class="fc0 fs14 inblock">ë‹´ë‹¹ì</span>
                                </div>
                                <div class="date fs15">{{item.answer.regDate}}</div>
                                <div class="cont fs15">
                                    {{item.answer.content}}
                                </div>
                                <textarea name="name" rows="8" cols="80" class="w100" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" style="display: none;"></textarea>
                                <div class="btn_area flex alc abs top0 right0">
                                    <button class="btn_border ok_btn" @click ="modifyReply('answer',item)" style="display: none;">í™•ì¸</button>
                                    <button class="btn_border ok_cancel" @click="cancelReply('answer',item.answer.id)" style="display: none;">ì·¨ì†Œ</button>
                                    <button class="btn_border update_btn" @click="editReply('answer',item.answer.id)">ìˆ˜ì •</button>
                                    <button class="btn_border delete_btn" @click="delQuestion('answer',item.answer.id)">ì‚­ì œ</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- v-for -->
                </div>

            </div>
        </div>
    </div>
    <Modal></Modal>

</div>
</template>
<script>
import { onMounted, reactive } from 'vue';
import { useRoute, useRouter } from 'vue-router';
import { _getProductDetail, _setProductAnswer
    , _setProductquestion, _getProductquestionList
    , _modifyProductAnswer, _modifyProductQuestion,
    _delProductQuestion, _delProductAnswer
} from '@/api/moviewApis.js';
import { clip } from '@/utils/commonFn.js';
import Modal from '@/views/modal/modal.vue';

export default {
    components: {Modal},
    setup() {
        const router = useRouter();
        const route = useRoute();
        const state = reactive({
            question: {
                content: ''
            },
            answer: {
                content: ''
            },
            questionList: [
                {id: '',
                    title: '',
                    content: '',
                    regUserNm: '',
                    regDate: '',
                    answer: {
                        id: '',
                        questionId: '',
                        title: '',
                        content: '',
                        regUserNm: '',
                        regDate: ''
                    }
                }
            ]

                
        });
        onMounted(() => {
            getProductDetail();
            getProductquestionList();
        });
        const getClip = () => {
            clip(route.query);
        };
        //ëª¨ë‹¬ì°½ ì—´ê¸°
        const getModal = (v) => {
            const param = {
                managerName: 'ëª¨ë‘ì˜ì¸í„°ë·°',
                managerPhone: '01012341234',
                managerEmail: 'admin@moview.com'
            };
            emitter.$emit('modalOpen', v, param);
        };
        //ìƒì„¸ë‚´ìš© ì¡°íšŒ
        const getProductDetail = async () => {
            // let params = {};
            const response = await _getProductDetail(route.query.id);
            try {
                if (response.data.code === 200) {
                    console.log(response);
                    console.log('ìƒì„¸ ë‚´ìš©ì´ ì¡°íšŒ ë˜ì—ˆìŠµë‹ˆë‹¤');
                } else {
                    console.log(response.data.message);
                }
            } catch (e) {
                console.log(e);
            }
        };
        //ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
        const getProductquestionList = async () => {
            let params = {
                productId: route.query.id,
                paging: 1
            };
            const response = await _getProductquestionList(params);
            try {
                if (response.data.code === 200) {
                    console.log(response);
                    state.questionList = response.data.data;
                    console.log(state.questionList);
                    console.log('ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ë˜ì—ˆìŠµë‹ˆë‹¤');
                    
                } else {
                    console.log(response.data.message);
                }
            } catch (e) {
                console.log(e);
            }
        };
        //ë¬¸ì˜ ë“±ë¡
        const setProductquestion = async () => {
            let params = {
                userId: 'user001',
                //from v-model input
                content: state.question.content
            };
            const response = await _setProductquestion(params);
            try {
                if (response.data.code === 200) {
                    console.log(response);
                    console.log('ìƒí’ˆ ì§ˆë¬¸ì´ ë“±ë¡ ë˜ì—ˆìŠµë‹ˆë‹¤');
                    state.question.content = '';
                    getProductquestionList();
                } else {
                    console.log(response.data.message);
                }
            } catch (e) {
                console.log(e);
            }
        };
        //ë‹µë³€ ë“±ë¡
        const setProductAnswer = async () => {
            let params = {
                userId: 'user001',
                //from v-model input
                content: state.answer.content
            };
            const response = await _setProductAnswer(params);
            try {
                if (response.data.code === 200) {
                    console.log(response);
                    console.log('ë‹µë³€ì´ ë“±ë¡ ë˜ì—ˆìŠµë‹ˆë‹¤');
                    state.answer.content = '';
                    getProductquestionList();
                } else {
                    console.log(response.data.message);
                }
            } catch (e) {
                console.log(e);
            }
        };
        //ì§ˆë¬¸ ìˆ˜ì • í´ë¦­
        const editReply = (type, id) => {
            document.querySelector('.' + type + id + ' .cont').style.display = 'none';
            document.querySelector('.' + type + id + ' .update_btn').style.display = 'none';
            document.querySelector('.' + type + id + ' .delete_btn').style.display = 'none';
            document.querySelector('.' + type + id + ' textarea').style.display = 'block';
            document.querySelector('.' + type + id + ' .ok_btn').style.display = 'block';
            document.querySelector('.' + type + id + ' .ok_cancel').style.display = 'block';
        };
        //ìˆ˜ì • ì·¨ì†Œ í´ë¦­ 
        const cancelReply = (type, id) => {
            document.querySelector('.' + type + id + ' .cont').style.display = 'block';
            document.querySelector('.' + type + id + ' .update_btn').style.display = 'block';
            document.querySelector('.' + type + id + ' .delete_btn').style.display = 'block';
            document.querySelector('.' + type + id + ' textarea').style.display = 'none';
            document.querySelector('.' + type + id + ' .ok_btn').style.display = 'none';
            document.querySelector('.' + type + id + ' .ok_cancel').style.display = 'none';
            document.querySelector('.' + type + id + ' textarea').value = '';
        };
        //ì§ˆë¬¸ ìˆ˜ì •ë‚´ìš© ì €ì¥
        const modifyReply = async (type, item) => {
            let params = '';
            let typeNm = '';
            let response = '';
            if (type == 'answer') {
                params = item.answer.id;
                response = await _modifyProductAnswer(params);
                typeNm = 'ë‹µë³€';
            } else if (type == 'question') {
                params = item.id;
                response = await _modifyProductQuestion(params);
                typeNm = 'ì§ˆë¬¸';
            } try {
                if (response.data.code === 200) {
                    console.log(response);
                    console.log(typeNm + 'ì´ ìˆ˜ì • ë˜ì—ˆìŠµë‹ˆë‹¤');
                    cancelReply(type, params);
                    getProductquestionList();
                } else {
                    console.log(response.data.message);
                }
            } catch (e) {
                console.log(e);
            }
        };

        //ì§ˆë¬¸ ì‚­ì œ
        const delQuestion = async (type, item) => {
            let params = item;
            let typeNm = '';
            let response = '';
            if (type == 'answer') {
                response = await _delProductAnswer(params);
                typeNm = 'ë‹µë³€';
            } else if (type == 'question') {
                response = await _delProductQuestion(params);
                typeNm = 'ì§ˆë¬¸';
            } try {
                if (response.data.code === 200) {
                    console.log(response);
                    console.log(typeNm + 'ì´ ì‚­ì œ ë˜ì—ˆìŠµë‹ˆë‹¤');
                    cancelReply(type, params);
                    getProductquestionList();
                } else {
                    console.log(response.data.message);
                }
            } catch (e) {
                console.log(e);
            }
        };




        /** ë·°í˜ì´ì§€ ë¬¸ì˜í•˜ê¸° **/
// $('.qa_box2 .btn_area .update_btn').on('click',function(){
//     $(this).parents('.btn_area').siblings('.cont').hide();
//     $(this).parents('.btn_area').siblings('textarea').show();
//     $(this).hide();
//     $(this).siblings('.ok_btn').show();
// })

// $('.qa_box2 .btn_area .ok_btn').on('click',function(){
//     $(this).parents('.btn_area').siblings('.cont').show();
//     $(this).parents('.btn_area').siblings('textarea').hide();
//     $(this).hide();
//     $(this).siblings('.update_btn').show();
// })



        return {
            state,
            getProductDetail,
            getModal,
            getClip,
            getProductquestionList,
            setProductAnswer,
            setProductquestion,
            editReply,
            modifyReply,
            delQuestion,
            cancelReply
        };
    }
};
</script>
<style scoped>

</style>
